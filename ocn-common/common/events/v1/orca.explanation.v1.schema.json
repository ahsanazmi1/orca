{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://schemas.ocn.ai/events/v1/orca.explanation.v1.schema.json",
    "title": "Orca Explanation CloudEvent",
    "description": "CloudEvent schema for Orca explanation events",
    "type": "object",
    "required": [
        "specversion",
        "id",
        "source",
        "type",
        "subject",
        "time",
        "data"
    ],
    "properties": {
        "specversion": {
            "type": "string",
            "const": "1.0",
            "description": "CloudEvents specification version"
        },
        "id": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier for the event"
        },
        "source": {
            "type": "string",
            "format": "uri",
            "pattern": "^https://orca\\.ocn\\.ai/",
            "description": "URI identifying the event producer"
        },
        "type": {
            "type": "string",
            "const": "ocn.orca.explanation.v1",
            "description": "Event type identifier"
        },
        "subject": {
            "type": "string",
            "pattern": "^txn_[a-f0-9]{16}$",
            "description": "Transaction ID (trace_id) for correlation"
        },
        "time": {
            "type": "string",
            "format": "date-time",
            "description": "Event timestamp in RFC3339 format"
        },
        "datacontenttype": {
            "type": "string",
            "const": "application/json",
            "description": "Content type of the data payload"
        },
        "dataschema": {
            "type": "string",
            "format": "uri",
            "const": "https://schemas.ocn.ai/ap2/v1/explanation.schema.json",
            "description": "Schema URI for the data payload"
        },
        "data": {
            "type": "object",
            "description": "Explanation payload",
            "required": [
                "trace_id",
                "decision_result",
                "explanation",
                "confidence",
                "model_provenance"
            ],
            "properties": {
                "trace_id": {
                    "type": "string",
                    "pattern": "^txn_[a-f0-9]{16}$",
                    "description": "Transaction ID for correlation"
                },
                "decision_result": {
                    "type": "string",
                    "enum": [
                        "APPROVE",
                        "DECLINE",
                        "REVIEW"
                    ],
                    "description": "Original decision result"
                },
                "explanation": {
                    "type": "string",
                    "minLength": 10,
                    "maxLength": 2000,
                    "description": "Human-readable explanation"
                },
                "confidence": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Confidence score for the explanation"
                },
                "key_factors": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "maxItems": 10,
                    "description": "Key risk factors that influenced the decision"
                },
                "model_provenance": {
                    "type": "object",
                    "properties": {
                        "model_name": {
                            "type": "string"
                        },
                        "provider": {
                            "type": "string"
                        },
                        "version": {
                            "type": "string"
                        },
                        "timestamp": {
                            "type": "string",
                            "format": "date-time"
                        },
                        "processing_time_ms": {
                            "type": "integer",
                            "minimum": 0
                        },
                        "tokens_used": {
                            "type": "integer",
                            "minimum": 0
                        }
                    }
                },
                "risk_score": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "ML risk score that influenced the decision"
                },
                "reason_codes": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Machine-readable reason codes"
                }
            }
        }
    },
    "additionalProperties": false
}
