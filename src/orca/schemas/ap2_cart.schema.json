{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://orca.ai/schemas/ap2_cart.schema.json",
    "title": "AP2 Cart Mandate Schema",
    "description": "Schema for AP2 Cart Mandate - defines shopping cart contents and context",
    "type": "object",
    "properties": {
        "items": {
            "type": "array",
            "minItems": 1,
            "description": "Cart items",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique item identifier"
                    },
                    "name": {
                        "type": "string",
                        "description": "Item name"
                    },
                    "description": {
                        "type": "string",
                        "description": "Item description"
                    },
                    "quantity": {
                        "type": "integer",
                        "minimum": 1,
                        "description": "Item quantity"
                    },
                    "unit_price": {
                        "type": "number",
                        "minimum": 0,
                        "description": "Unit price"
                    },
                    "total_price": {
                        "type": "number",
                        "minimum": 0,
                        "description": "Total price for this item"
                    },
                    "category": {
                        "type": "string",
                        "description": "Item category"
                    },
                    "sku": {
                        "type": "string",
                        "description": "Stock keeping unit"
                    }
                },
                "required": [
                    "id",
                    "name",
                    "quantity",
                    "unit_price",
                    "total_price"
                ],
                "additionalProperties": false
            }
        },
        "amount": {
            "type": "number",
            "minimum": 0,
            "description": "Total cart amount"
        },
        "currency": {
            "type": "string",
            "minLength": 3,
            "maxLength": 3,
            "pattern": "^[A-Z]{3}$",
            "description": "Currency code (ISO 4217)"
        },
        "mcc": {
            "type": "string",
            "description": "Merchant category code"
        },
        "geo": {
            "type": "object",
            "description": "Geographic location",
            "properties": {
                "country": {
                    "type": "string",
                    "pattern": "^[A-Z]{2}$",
                    "description": "Country code (ISO 3166-1 alpha-2)"
                },
                "region": {
                    "type": "string",
                    "description": "Region/state"
                },
                "city": {
                    "type": "string",
                    "description": "City"
                },
                "latitude": {
                    "type": "number",
                    "minimum": -90,
                    "maximum": 90,
                    "description": "Latitude"
                },
                "longitude": {
                    "type": "number",
                    "minimum": -180,
                    "maximum": 180,
                    "description": "Longitude"
                },
                "timezone": {
                    "type": "string",
                    "description": "Timezone identifier"
                }
            },
            "required": [
                "country"
            ],
            "additionalProperties": false
        },
        "risk_flags": {
            "type": "array",
            "description": "Risk assessment flags",
            "items": {
                "type": "string",
                "enum": [
                    "low",
                    "medium",
                    "high",
                    "critical"
                ]
            }
        },
        "metadata": {
            "type": "object",
            "description": "Additional metadata",
            "additionalProperties": true
        }
    },
    "required": [
        "items",
        "amount",
        "currency"
    ],
    "additionalProperties": false
}
